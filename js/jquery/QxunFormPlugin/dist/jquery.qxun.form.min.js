/*! jquery.qxun.form 2016-08-07 */
+function(a){"use strict";function b(b){return this.each(function(){new c(a(this),b)})}var c=function(b,d){this.element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.validateFormObj=null,this.init()};c.VERSION="1.0.0",c.DEFAULTS={submitUrl:"",submitBtnId:"mobileSubmitBtn",validate:{rules:{},messages:{}},successRetrunUrl:"",extendValidate:null,extendSerialize:null,extendFill:null,afterSuccess:null,getFormDataUrl:"",primaryKeyId:"",isDetails:!1},c.prototype.init=function(){var b=this;this.initValidate(),this.bindEvent(),""!=a.trim(b.options.primaryKeyId)&&b.getFormData()},c.prototype.initValidate=function(){this.validateFormObj=this.element.validate(this.options.validate)},c.prototype.bindEvent=function(){var b=this;""!=a.trim(b.options.submitBtnId)&&a("#"+b.options.submitBtnId).bind("click",function(){return!!b.checkForm()&&void b.submit(b)})},c.prototype.submit=function(){var b=this;a.ajax({url:b.options.submitUrl,type:"post",data:b.serialize(),dataType:"json",beforeSend:function(){},success:function(a){b.afterSuccess(a)},error:function(){return alert("服务器异常！"),!1}})},c.prototype.serialize=function(){function a(a){var b={};for(var c in a)"undefined"==typeof b[a[c].name]?b[a[c].name]=a[c].value:b[a[c].name]+=","+a[c].value;return b}var b=a(this.element.serializeArray());return this.extendSerialize(b)},c.prototype.checkForm=function(){var a=this.validateFormObj.checkForm();return this.validateFormObj.showErrors(),a?this.extendValidate():a},c.prototype.extendValidate=function(){return!a.isFunction(this.options.extendValidate)||this.options.extendValidate()},c.prototype.extendSerialize=function(b){return a.isFunction(this.options.extendSerialize)&&(b=this.options.extendSerialize(b)),b},c.prototype.afterSuccess=function(b){function c(){return null==b||0!=b.code?(alert(b.message),!1):void(""==that.successRetrunUrl?location=location:location.href=that.successRetrunUrl)}a.isFunction(this.options.afterSuccess)?this.options.afterSuccess(b):c(b,this.options)},c.prototype.extendFill=function(b){a.isFunction(this.options.extendFill)&&this.options.extendFill(b)},c.prototype.resetForm=function(){this.element[0].reset()},c.prototype.getFormData=function(){var b=this;a.ajax({url:b.options.getFormDataUrl,type:"get",dataType:"json",beforeSend:function(){},success:function(a){null==a?alert("获取数据失败！"):a.IsSuccess?b.options.isDetails?b.autoFillDetails(a.ExtInfo):b.autoFillForm(a.ExtInfo):alert(a.message)},error:function(){return alert("服务器异常！获取数据失败！"),!1}})},c.prototype.autoFillForm=function(b){var c,d,e,f,g,h=this;for(var i in b)c=i,d=b[i],a(h.element).find("[name='"+c+"'],[name='"+c+"[]']").each(function(){if(e=a(this)[0].tagName,f=a(this).attr("type"),"INPUT"==e)if("radio"==f)a(this).attr("checked",a(this).val()==d);else if("checkbox"==f){g=d.split(",");for(var b=0;b<g.length;b++)if(a(this).val()==g[b]){a(this).attr("checked",!0);break}}else a(this).val(d);else"SELECT"==e?a(this).val(d).change():"TEXTAREA"==e&&a(this).val(d)});h.extendFill(b)},c.prototype.autoFillDetails=function(b){var c,d,e,f=this;for(var g in b)c=g,d=b[g],a("p[name='"+c+"']").each(function(){switch(e=a(this).attr("data-type")){case"img":break;case"vioce":break;case"map":break;default:a(this).html(d)}});f.extendFill(b)};var d=a.fn.qxunForm;a.fn.qxunForm=b,a.fn.qxunForm.Constructor=c,a.fn.qxunForm.noConflict=function(){return a.fn.qxunForm=d,this}}(jQuery);