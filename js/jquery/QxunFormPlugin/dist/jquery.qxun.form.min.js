/*! jquery.qxun.form 2016-08-15 */
+function(a){"use strict";function b(b){return this.each(function(){new c(a(this),b)})}var c=function(b,d){this.element=a(b),this.options=a.extend(!0,{},c.DEFAULTS,d),this.validateFormObj=this.element.validate(this.options.validate),this.init()};c.VERSION="1.0.0",c.DEFAULTS={submitBtnId:"formSubmitBtn",submitUrl:"",validate:null,clearForm:!0,resetForm:!0,extendBeforeSubmit:{validate:null,serialize:null},extendAfterSubmit:{success:null,error:null},afterSuccessUrl:"",getDataUrl:"",isDetails:!1,extendFill:null},c.prototype.init=function(){var b=this;this.bindEvent(),""!=a.trim(b.options.getDataUrl)&&b.getFormData()},c.prototype.bindEvent=function(){var b=this;""!=a.trim(b.options.submitBtnId)&&a("#"+b.options.submitBtnId).bind("click",function(){return!!b.checkForm()&&(b.submit(),void a("#"+b.options.submitBtnId).attr("disabled","true"))})},c.prototype.submit=function(){var b=this;a.ajax({url:b.options.submitUrl,type:"post",data:b.serialize(),dataType:"json",beforeSend:function(){},success:function(a){b.extendAfterSubmit.success(b,a)},error:function(a,c,d){b.extendAfterSubmit.error(b,a,c,d)},complete:function(){a("#"+b.options.submitBtnId).removeAttr("disabled")}})},c.prototype.serialize=function(){var b={},c=this.element.serializeArray();a.each(c,function(){void 0!==b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""});var d=a("input[type=radio],input[type=checkbox]",this.element);return a.each(d,function(){b.hasOwnProperty(this.name)||(b[this.name]="")}),this.extendBeforeSubmit.serialize(this,b)},c.prototype.extendBeforeSubmit={validate:function(b){return!a.isFunction(b.options.extendBeforeSubmit.validate)||b.options.extendBeforeSubmit.validate()},serialize:function(b,c){return a.isFunction(b.options.extendBeforeSubmit.serialize)&&(c=b.options.extendBeforeSubmit.serialize(c)),c}},c.prototype.extendAfterSubmit={success:function(b,c){function d(){if(null!=c){if(!c.IsSuccess)return alert(c.message),!1;b.options.resetForm&&b.element.resetForm(),b.options.clearForm&&b.element.clearForm(),""==a.trim(b.options.afterSuccessUrl)?location=location:location.href=b.options.afterSuccessUrl}else alert("后台出错了")}a.isFunction(b.options.extendAfterSubmit.success)?this.options.extendAfterSubmit.success(c):d()},error:function(b,c,d,e){return a.isFunction(b.options.extendAfterSubmit.error)?void b.options.extendAfterSubmit.error(c,d,e):(alert(c.status+" "+d+" "+e),!1)}},c.prototype.checkForm=function(){var a=this.validateFormObj.checkForm();return this.validateFormObj.showErrors(),a?this.extendBeforeSubmit.validate(this):a},c.prototype.getFormData=function(){var b=this;a.ajax({url:b.options.getDataUrl,type:"get",dataType:"json",beforeSend:function(){},success:function(a){null!=a?a.IsSuccess?b.options.isDetails?b.autoFillDetails(a.ExtInfo):b.autoFillForm(a.ExtInfo):alert(a.message):alert("后台出错了！")},error:function(a,b,c){return alert(a.status+" "+b+" "+c),!1}})},c.prototype.autoFillForm=function(b){var c,d,e,f,g,h=this;for(var i in b)c=i,d=b[i],a(h.element).find("[name='"+c+"'],[name='"+c+"[]']").each(function(){if(e=a(this)[0].tagName,f=a(this).attr("type"),"INPUT"==e)if("radio"==f)a(this).attr("checked",a(this).val()==d);else if("checkbox"==f){g=d.split(",");for(var b=0;b<g.length;b++)if(a(this).val()==g[b]){a(this).attr("checked",!0);break}}else a(this).val(d);else"SELECT"!=e&&"TEXTAREA"!=e||a(this).val(d)});h.extendFill(b)},c.prototype.autoFillDetails=function(b){var c,d,e,f=this;for(var g in b)c=g,d=b[g],a(f.element).find("[name='"+c+"']").each(function(){switch(e=a(this).attr("data-type")){case"img":break;case"vioce":break;case"map":break;default:a(this).html(d)}});f.extendFill(b)},c.prototype.extendFill=function(b){a.isFunction(this.options.extendFill)&&this.options.extendFill(b)};var d={};d.fileapi=void 0!==a("<input type='file'/>").get(0).files,d.formdata=void 0!==window.FormData,a.fn.formToArray=function(b,c){var e=[];if(0===this.length)return e;var f,g=this[0],h=this.attr("id"),i=b?g.getElementsByTagName("*"):g.elements;if(i&&!/MSIE [678]/.test(navigator.userAgent)&&(i=a(i).get()),h&&(f=a(':input[form="'+h+'"]').get(),f.length&&(i=(i||[]).concat(f))),!i||!i.length)return e;var j,k,l,m,n,o,p;for(j=0,o=i.length;j<o;j++)if(n=i[j],l=n.name,l&&!n.disabled)if(b&&g.clk&&"image"==n.type)g.clk==n&&(e.push({name:l,value:a(n).val(),type:n.type}),e.push({name:l+".x",value:g.clk_x},{name:l+".y",value:g.clk_y}));else if(m=a.fieldValue(n,!0),m&&m.constructor==Array)for(c&&c.push(n),k=0,p=m.length;k<p;k++)e.push({name:l,value:m[k]});else if(d.fileapi&&"file"==n.type){c&&c.push(n);var q=n.files;if(q.length)for(k=0;k<q.length;k++)e.push({name:l,value:q[k],type:n.type});else e.push({name:l,value:"",type:n.type})}else null!==m&&"undefined"!=typeof m&&(c&&c.push(n),e.push({name:l,value:m,type:n.type,required:n.required}));if(!b&&g.clk){var r=a(g.clk),s=r[0];l=s.name,l&&!s.disabled&&"image"==s.type&&(e.push({name:l,value:r.val()}),e.push({name:l+".x",value:g.clk_x},{name:l+".y",value:g.clk_y}))}return e},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;f<g;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,value:e})}}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;d<e;d++){var f=this[d],g=a.fieldValue(f,b);null===g||"undefined"==typeof g||g.constructor==Array&&!g.length||(g.constructor==Array?a.merge(c,g):c.push(g))}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();if(void 0===c&&(c=!0),c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&b.selectedIndex==-1))return null;if("select"==f){var g=b.selectedIndex;if(g<0)return null;for(var h=[],i=b.options,j="select-one"==e,k=j?g+1:i.length,l=j?g:0;l<k;l++){var m=i[l];if(m.selected){var n=m.value;if(n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,e=this.tagName.toLowerCase();c.test(d)||"textarea"==e?this.value="":"checkbox"==d||"radio"==d?this.checked=!1:"select"==e?this.selectedIndex=-1:"file"==d?/MSIE/.test(navigator.userAgent)?a(this).replaceWith(a(this).clone(!0)):a(this).val(""):b&&(b===!0&&/hidden/.test(d)||"string"==typeof b&&a(this).is(b))&&(this.value="")})},a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})};var e=a.fn.qxunForm;a.fn.qxunForm=b,a.fn.qxunForm.Constructor=c,a.fn.qxunForm.noConflict=function(){return a.fn.qxunForm=e,this}}(jQuery);